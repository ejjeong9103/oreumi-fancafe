<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../static/css/reset.css"/>
    <link rel="stylesheet" href="../static/css/post.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
<div class="container">
    <h1 th:text="${article.boardType == 1 ? '등업게시판' : (article.boardType == 2 ? '자유게시판' : (article.boardType == 3 ? '정모게시판' : '기타 게시판'))}"></h1>
    <p class="text-muted" th:text="${article.boardType == 1 ? '등업 게시판에 오신 것을 환영합니다.' :
                           (article.boardType == 2 ? '자유 게시판에 오신 것을 환영합니다.' :
                           (article.boardType == 3 ? '정모 게시판에 오신 것을 환영합니다.' :
                           '기타 게시판입니다.'))}">게시판 설명</p>

    <!-- 수정 및 삭제 버튼을 오른쪽 끝에 배치 -->
    <div class="d-flex justify-content-end mb-2" th:if="${isMyBoard}">
        <button class="btn btn-secondary btn-update me-2"
                th:onclick="|location.href='@{/board/article/edit/{id}(id=${article.id})}'|">
            수정
        </button>
        <form th:action="@{/board/{id}(id=${article.id})}" method="post" onsubmit="return confirmDelete()">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit" class="btn btn-danger">삭제</button>
        </form>
    </div>

    <article class="board-page">
        <!-- 작성자와 작성일을 같은 줄에 배치 -->
        <div class="d-flex justify-content-between align-items-center mb-2">
            <p style="font-weight: bold;" th:text="${user.nickname}"></p>
            <p class="text-secondary mb-0">
                <span th:if="${article.updatedAt != article.createdAt}"
                      th:text="${#temporals.format(article.updatedAt, 'yyyy-MM-dd HH:mm') + ' 수정됨'}"></span>
                <span th:if="${article.updatedAt == article.createdAt}"
                      th:text="${#temporals.format(article.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
            </p>
        </div>

        <hr>

        <div class="article-body">
            <p class="article-body-text text-break" th:text="${article.content}"></p>
        </div>

        <div class="article-comment">
            <p class="comment-count">댓글 n</p>
            <hr>
            <div class="comment-list d-block" th:if="${comment}">
                <div class="col comment" th:each="item:${comment}" th:classappend="${comment.hierarchy == 1} ? 'padding-left' : ''">
                    <div class="row comment-pic-box">
                        <img class="comment-pic" th:classappend="${item} ? '' : 'd-flex'"
                             th:src="${item.userPic != null} ? @{${item.userPic}} : @{ '임시프로필사진.jpg' }" alt="프로필 사진">
                    </div>
                    <div class="row comment-context">
                        <p class="comment-writer" th:text="${item.userId}"></p>
                        <p class="comment-body text-break" th:text="${item.context}"></p>
                        <p class="comment-createdAt text-secondary" th:text="${#temporals.format(item.createdAt, 'yyyy-MM-dd HH:mm')}"></p>
                    </div>
                </div>
            </div>
            <form class="comment-create bg-light" style="padding: 0 30px;">
                <div>
                    <label for="commentbox" th:text="${loggedInUser != null ? loggedInUser.nickname : ''}"></label><br>
                    <textarea class="w-100" id="commentbox" name="commentbox" rows="3" spellcheck="false" maxlength="600" style="resize: none; background-color: white; border: none; width: 100%;"></textarea>
                </div>
                <div class="d-flex justify-content-end align-items-center">
                    <span id="charCount" class="text-muted">0/600</span>
                    <button class="btn btn-light comment-write-btn me-2" type="submit">작성</button>
                </div>
            </form>
        </div>

        <div class="page-button-list d-flex justify-content-between">
            <div>
                <a th:href="@{/board/{boardType}/1(boardType=${boardType})}">
                    <button class="btn btn-secondary board-btn" type="button">목록</button>
                </a>
            </div>
            <div class="write-btn-div d-flex justify-content-end">
                <button class="btn btn-secondary write-btn" th:onclick="|location.href='@{/board/new-article}'|">글 작성</button>
            </div>
        </div>
    </article>
</div>

<script>
    document.getElementById('commentbox').addEventListener('input', function() {
        const maxLength = 600;
        const currentLength = this.value.length;
        document.getElementById('charCount').textContent = `${currentLength}/${maxLength}`;
    });
    function confirmDelete() {
        return confirm("삭제하시겠습니까?");
    }
</script>

</body>
</html>
